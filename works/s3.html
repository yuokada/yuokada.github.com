<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>s3について気になったこと &#8212; my blog 2018.052701 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          my blog</a>
        <span class="navbar-text navbar-version pull-left"><b>2.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../history.html">職務経歴</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history2.html">職務経歴 その2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pg_history.html">プログラミング履歴</a></li>
<li class="toctree-l1"><a class="reference internal" href="../skill.html">技術スキル</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">s3について気になったこと</a><ul>
<li><a class="reference internal" href="#s3-s3n"><cite>s3://</cite> と <cite>s3n://</cite> について</a><ul>
<li><a class="reference internal" href="#aws">AWS上の解説</a></li>
<li><a class="reference internal" href="#osshadoop">OSS版のHadoopのオススメ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#s3cmd">s3cmd</a><ul>
<li><a class="reference internal" href="#install">install</a></li>
<li><a class="reference internal" href="#configure">configure</a></li>
<li><a class="reference internal" href="#usage">usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">s3互換ストレージ</a><ul>
<li><a class="reference internal" href="#another-one">another one</a></li>
</ul>
</li>
<li><a class="reference internal" href="#links">Links</a><ul>
<li><a class="reference internal" href="#id2">s3cmd</a></li>
<li><a class="reference internal" href="#slides">slides</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/works/s3.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="s3">
<h1>s3について気になったこと<a class="headerlink" href="#s3" title="Permalink to this headline">¶</a></h1>
<div class="section" id="s3-s3n">
<h2><cite>s3://</cite> と <cite>s3n://</cite> について<a class="headerlink" href="#s3-s3n" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Hadoopは、2種類のファイルシステムをS3向けに提供

- S3 ネイティブ ファイルシステム (URI scheme: s3n)
   これは、S3上のレギュラーファイルを読み書きするファイルシステム。このファイルシステムの有利な点は、
   S3上の他のツールで記述されたファイルにアクセスが出来ます。逆に言えば、他のツールは、
   Hadoopを使って書かれたファイルにアクセスできます。
   不利な点は、S3による5GBのファイルサイズの限界があることです。
   この理由の為、HDFSの置き換えとしては適切ではありません。
- S3 ブロック ファイルシステム (URI scheme: s3)
   S3によるブロック ベースのファイルシステム。ファイルはブロックとして保存され、
   HDFSにあるのと同じようになります。・一部訳なし・。このファイルシステムは、対象バケットを
   このファイルシステムとしてのみ使う事を必要とします - 既存のファイルを含むバケットを使ったり、
   他のファイルを対象バケットに書き込むことは出来ません。
   このファイルシステムに保存されるファイルは5GB以上が可能ですが、他のS3ツールとは相互利用が出来ません。
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>S3n:// の意味は　「レギュラーファイル（外の世界から読み込みができる）」 。
S3:// は、AWSストレージクラスター上のS3にマップされた、HDFSファイルシステムを参照できる。
なので、通常ファイルを使うときには 「s3n」 を使う事になる。
</pre></div>
</div>
<p>see: <a class="reference external" href="http://hideharaaws.hatenablog.com/entry/2013/08/29/160535">EMR利用時のURI Prefix “s3:// ” と “s3n://” の違い - AWS / PHP / Python ちょいメモ</a></p>
<div class="section" id="aws">
<h3>AWS上の解説<a class="headerlink" href="#aws" title="Permalink to this headline">¶</a></h3>
<p>2016/12現在だと <cite>s3://</cite> だけ使ってれば問題ないようです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>以前は、Amazon EMR は URI スキーム s3n で、S3 ネイティブファイルシステムを使用していました。
これは現在でも動作しますが、最適なパフォーマンス、セキュリティ、および信頼性のためには、s3 URI スキームを使用することをお勧めします。
</pre></div>
</div>
<p>see: <a class="reference external" href="http://docs.aws.amazon.com/ja_jp/ElasticMapReduce/latest/DeveloperGuide/emr-plan-file-systems.html">Amazon EMR と互換性のあるファイルシステム - Amazon EMR</a></p>
</div>
<div class="section" id="osshadoop">
<h3>OSS版のHadoopのオススメ<a class="headerlink" href="#osshadoop" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://wiki.apache.org/hadoop/AmazonS3">AmazonS3 - Hadoop Wiki</a></p>
<blockquote>
<div>Recommended: S3A (URI scheme: s3a://) - Hadoop 2.7+</div></blockquote>
<p>s3aを推奨されていて、s3nはメンテナンスが終わっている。さらに、s3は3.0で廃止されることを書いていた。</p>
</div>
</div>
<div class="section" id="s3cmd">
<h2>s3cmd<a class="headerlink" href="#s3cmd" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/s3tools/s3cmd">s3tools/s3cmd: Official s3cmd repo – Command line tool for managing Amazon S3 and CloudFront services</a></p>
<p>python製のs3を操作するためのコマンドラインツール。</p>
<div class="section" id="install">
<h3>install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<p>s3cmdがpython3対応が完了していないので2.x系でインストールする。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip2.7 install s3cmd
</pre></div>
</div>
</div>
<div class="section" id="configure">
<h3>configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ s3cmd --configure

<span class="c1"># 実行例</span>
$ s3cmd --configure
Enter new values or accept defaults in brackets with Enter.
Refer to user manual <span class="k">for</span> detailed description of all options.

Access key and Secret key are your identifiers <span class="k">for</span> Amazon S3. Leave them empty <span class="k">for</span> using the env variables.
Access Key: AAAAAAAAAAAAAA
Secret Key: XXXXXXXXXXXXXX
Default Region <span class="o">[</span>US<span class="o">]</span>:

Encryption password is used to protect your files from reading
by unauthorized persons <span class="k">while</span> in transfer to S3
Encryption password:
Path to GPG program:

When using secure HTTPS protocol all communication with Amazon S3
servers is protected from 3rd party eavesdropping. This method is
slower than plain HTTP, and can only be proxied with Python <span class="m">2</span>.7 or newer
Use HTTPS protocol <span class="o">[</span>Yes<span class="o">]</span>: No

On some networks all internet access must go through a HTTP proxy.
Try setting it here <span class="k">if</span> you can<span class="se">\&#39;</span>t connect to S3 directly
HTTP Proxy server name:

New settings:
  Access Key: AAAAAAAAAAAAAA
  Secret Key: XXXXXXXXXXXXXX
  Default Region: US
  Encryption password:
  Path to GPG program: None
  Use HTTPS protocol: False
  HTTP Proxy server name:
  HTTP Proxy server port: <span class="m">0</span>

Test access with supplied credentials? <span class="o">[</span>Y/n<span class="o">]</span> Y
Please wait, attempting to list all buckets...
Success. Your access key and secret key worked fine :-<span class="o">)</span>

Now verifying that encryption works...
Not configured. Never mind.

Save settings? <span class="o">[</span>y/N<span class="o">]</span> y
Configuration saved to <span class="s1">&#39;$HOME/.s3cfg&#39;</span>
</pre></div>
</div>
<p>今回はアップロードしないのでこれでOKそう。</p>
</div>
<div class="section" id="usage">
<h3>usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>バケット一覧の取得</dt>
<dd><div class="first last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ s3cmd ls
<span class="m">2016</span>-12-28 <span class="m">05</span>:35  s3://igudas
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ファイル一覧の取得</dt>
<dd><div class="first last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ s3cmd ls s3://igudas
                       DIR   s3://igudas/data/
<span class="m">2016</span>-12-28 <span class="m">05</span>:49      <span class="m">1562</span>   s3://igudas/swagger.yaml
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ファイルの取得</dt>
<dd><div class="first last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ s3cmd get s3://igudas/swagger.yaml
download: <span class="s1">&#39;s3://igudas/swagger.yaml&#39;</span> -&gt; <span class="s1">&#39;./swagger.yaml&#39;</span>  <span class="o">[</span><span class="m">1</span> of <span class="m">1</span><span class="o">]</span>
download: <span class="s1">&#39;s3://igudas/swagger.yaml&#39;</span> -&gt; <span class="s1">&#39;./swagger.yaml&#39;</span>  <span class="o">[</span><span class="m">1</span> of <span class="m">1</span><span class="o">]</span>
download: <span class="s1">&#39;s3://igudas/swagger.yaml&#39;</span> -&gt; <span class="s1">&#39;./swagger.yaml&#39;</span>  <span class="o">[</span><span class="m">1</span> of <span class="m">1</span><span class="o">]</span>
<span class="m">1562</span> of <span class="m">1562</span>   <span class="m">100</span>% in    0s     <span class="m">4</span>.33 kB/s  <span class="k">done</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ファイルの削除</dt>
<dd><div class="first last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ s3cmd del s3://igudas/swagger.yaml
delete: <span class="s1">&#39;s3://igudas/swagger.yaml&#39;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
<p>オプションを渡せば再帰的にディレクトリを操作することも可能なのでこのコマンドだけで一通りのことは出来そう。</p>
</div>
</div>
<div class="section" id="id1">
<h2>s3互換ストレージ<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><a class="reference external" href="https://minio.io/">Minio</a></div>
<div class="line"><a class="reference external" href="https://github.com/minio/minio">minio/minio: Minio is an Amazon S3 compatible object storage server.</a></div>
</div>
<p>Go言語製のs3互換ストレージ。 開発も活発なので使い勝手良さそう。</p>
<div class="section" id="another-one">
<h3>another one<a class="headerlink" href="#another-one" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://github.com/johannesboyne/gofakes3">johannesboyne/gofakes3: A simple fake AWS S3 object storage based on BoltDB (used for local test-runs against AWS S3 APIs)</a></li>
</ul>
</div>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/Welcome.html">Amazon S3 とは何ですか？ - Amazon Simple Storage Service</a></li>
<li><a class="reference external" href="http://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/MakingRequests.html">リクエストの実行 - Amazon Simple Storage Service</a></li>
</ul>
<div class="section" id="id2">
<h3>s3cmd<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://www.faq.idcf.jp/app/answers/detail/a_id/360/~/s3cmd%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%B8%80%E8%A6%A7">s3cmdのコマンド一覧 | オブジェクトストレージ</a></li>
<li><a class="reference external" href="http://recipe.kc-cloud.jp/archives/1059">Amazon S3 編。S3 を s3cmd で操作する方法をご説明 | 使い方・ナレコムAWSクラウド | ナレコムAWSレシピ</a></li>
<li><a class="reference external" href="http://perezvon.hatenablog.com/entry/20101216/1292518865">s3cmdを使ってS3にアクセスする - スコトプリゴニエフスク通信</a></li>
</ul>
</div>
<div class="section" id="slides">
<h3>slides<a class="headerlink" href="#slides" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.slideshare.net/AmazonWebServicesJapan/amazon-s3-66753750">Amazon S3を中心とするデータ分析のベストプラクティス</a></li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Yukihiro Okada.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>